C51 COMPILER V9.54   93C46                                                                 10/16/2019 16:01:01 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE 93C46
OBJECT MODULE PLACED IN .\Objects\93C46.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\HARDWARE\93c46\93C46.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(..\HARDW
                    -ARE;..\SYSTEM;..\USER;..\HARDWARE\key;..\HARDWARE\LCD12864;..\HARDWARE\93c46) DEBUG OBJECTEXTEND PRINT(.\Listings\93C46.
                    -lst) TABS(2) OBJECT(.\Objects\93C46.obj)

line level    source

   1          #include "system.h"
   2          #include "93C46.h"
   3          
   4          //93C46¶Ë¿Ú³õÊ¼»¯
   5          void AT93C46_Hardwarw_Init(void)
   6          {
   7   1          P6_Mode_PullUp(SPI_CS_PIN|SPI_SCL_PIN|SPI_DO_PIN);
   8   1        P6_Mode_HighZ(SPI_DI_PIN);
   9   1          CS(0);//³õÊ¼»¯¶Ë¿Ú
  10   1          SCL(0);
  11   1          DO(1);
  12   1      }
  13          
  14          /**********************************************************/
  15          //Ð´ÈëÊý¾Ý
  16          void Write46(unsigned char indata)               
  17          {
  18   1         unsigned char i;
  19   1        
  20   1         for(i = 0; i < 8; i++)
  21   1         {
  22   2            DO(((indata & 0x80)>>7));// ÏÈÒÆÈë¸ßÎ»
  23   2            SCL(1);
  24   2          Delay_us(1);
  25   2            indata <<= 1;
  26   2            SCL(0);  
  27   2          Delay_us(1);
  28   2         }
  29   1         DO(1);
  30   1      }
  31          
  32          /**********************************************************/
  33          // ¶Á³öÊý¾Ý        
  34          unsigned char Read46(void)         
  35          {
  36   1         unsigned char i, out_data;
  37   1         for(i = 0; i < 8; i++)
  38   1         {
  39   2            SCL(1);
  40   2          Delay_us(1);
  41   2            out_data <<= 1;
  42   2            SCL(0);
  43   2          Delay_us(1);
  44   2            out_data |= (unsigned char)DI();
  45   2         }
  46   1         return(out_data);
  47   1      }
  48          
  49          /**********************************************************/
  50          //·¢ËÍÒ»¸öÎ»
  51          void Sendbit (uint8_t IO)            
  52          {
  53   1        //IO=IO&0x80;
C51 COMPILER V9.54   93C46                                                                 10/16/2019 16:01:01 PAGE 2   

  54   1        if(IO&0x01)
  55   1          DO(1);
  56   1          else 
  57   1          DO(0);   
  58   1          SCL(1);
  59   1        Delay_us(1);
  60   1        SCL(0);      //Ð´ÈëÂö³å
  61   1      }
  62          
  63          /*¶ÁÐ´¹¦ÄÜ²Ù×÷º¯Êý*/
  64          
  65          /**********************************************************/
  66          //Éè¶¨ Ð´ÔÊÐí ¹¦ÄÜº¯Êý£¬ ¿ØÖÆÂë 1 00 11XXXXX  Ð´ÈëÊý¾ÝÇ°£¬ÐèÒª¸Ä±äEWENµÄ×´Ì¬
  67          void EWEN46 (void)            
  68          {
  69   1        CS(0);
  70   1        SCL(0);
  71   1          Delay_us(1);  
  72   1          CS(1);                      //Æ¬Ñ¡
  73   1          Sendbit(1);                //·¢ËÍÆðÊ¼Î»
  74   1          Sendbit(0);                //·¢ËÍ²Ù×÷Âë¸ßÎ»
  75   1          Write46(0x60);             //½«µØÖ·ÐÅÏ¢Óë²Ù×÷ÂëµÍÎ»ÕûºÏ£¬Ò»Æð·¢ËÍ
  76   1          CS(0);                      //È¡ÏûÆ¬Ñ¡
  77   1        Delay_us(1);
  78   1      }
  79          
  80          /**********************************************************/
  81          //Éè¶¨ Ð´½ûÖ¹ ¹¦ÄÜº¯Êý£¬ ¿ØÖÆÂë 1 00 00XXXXX  Êý¾ÝÐ´ÈëÍê³Éºó±£»¤Êý¾Ý
  82          void EWDS46 (void)            
  83          {
  84   1        Delay_us(1);
  85   1        CS(1);
  86   1        Sendbit(1);
  87   1        Sendbit(0);
  88   1        Write46(0x00);
  89   1        CS(0);
  90   1        Delay_us(1);
  91   1      }
  92          
  93          /**********************************************************/
  94          //Éè¶¨ ²Á³ýÈ«²¿ ¹¦ÄÜº¯Êý£¬¿ØÖÆÂë 1 00 10XXXXX  Ä¨³ýÊý¾Ý
  95          void ERAL46 (void)            
  96          {
  97   1        CS(0);
  98   1        Delay_us(1);
  99   1        CS(1);
 100   1        Sendbit(1);
 101   1        Sendbit(0);
 102   1        Write46(0x40);
 103   1        CS(0);
 104   1        Delay_us(1);
 105   1      }
 106          
 107          //ÓÃ»§½Ó¿Ú¹¦ÄÜº¯Êý
 108          
 109          /**********************************************************/
 110          //Ö¸¶¨µØÖ·£¬¶ÁÈ¡Ò»¸ö×Ö½Ú£¬¿ØÖÆÂë 1 10 XXXXXXX
 111          char AT93C46_Read_Byte (unsigned char addr)       
 112          {                                      //ÆßÎ»µØÖ·¶ÔÓ¦8bitÄ£Ê½    
 113   1        CS(0);
 114   1          SCL(0);
 115   1        Delay_us(1);
C51 COMPILER V9.54   93C46                                                                 10/16/2019 16:01:01 PAGE 3   

 116   1        CS(1);                              //Æ¬Ñ¡¿ª
 117   1      
 118   1        Delay_us(1);                          //ÑÓÊ±
 119   1        Sendbit(1);                        //·¢ËÍ¿ªÊ¼Î»
 120   1        Sendbit(1);                        //·¢ËÍ²Ù×÷Âë¸ßÎ»
 121   1        Write46(0x7F&addr);                //ÕûºÏµØÖ·Óë²Ù×÷ÂëµØÎ»·¢ËÍ
 122   1        addr=Read46();                     //»ñÈ¡Êý¾Ý
 123   1        CS(0);
 124   1        Delay_us(1);                      //¹Ø±ÕÆ¬Ñ¡
 125   1        return (addr);                     //·µ»ØÊý¾Ý
 126   1      }
 127          
 128          /**********************************************************/
 129          //Ö¸¶¨µØÖ·£¬Ð´ÈëÒ»¸ö×Ö½Ú£¬¿ØÖÆÂë 1 01 XXXXXXX
 130          void AT93C46_Write_Byte (unsigned char addr,char thedata)    
 131          {                                            //ÆßÎ»µØÖ·¶ÔÓ¦8bitÄ£Ê½
 132   1        unsigned int time=0;                     //¶¨Òå³¬Ê±±äÁ¿
 133   1        unsigned char i=0;                       //¶¨ÒåÐ´ÈëÑ­»·±äÁ¿
 134   1        do
 135   1        {                                        //¿ªÊ¼Èý´ÎÐ´ÈëÑ­»·£¬³É¹¦Ð´ÈëÌø³ö
 136   2          CS(0);
 137   2              SCL(0);                                
 138   2          CS(1);                                //¿ªÆ¬Ñ¡ÐÅºÅ
 139   2          Delay_us(1);
 140   2          EWEN46();                            //¿ªÐ´ÈëÔÊÐí
 141   2          Delay_us(1);                           //ÑÓÊ±
 142   2          CS(1);                                //ÖØÐÂ¿ªÆ¬Ñ¡
 143   2          Delay_us(1);
 144   2          Sendbit(1);                          //·¢ËÍ¿ªÊ¼Âë
 145   2          Sendbit(0);                          //·¢ËÍ²Ù×÷Âë¸ßÎ»
 146   2          Write46(0x80|addr);                  //ÕûºÏ²Ù×÷ÂëµÍÎ»ÓëÆßÎ»µØÖ·
 147   2          Write46(thedata);                    //Ð´ÈëÊý¾Ý
 148   2          CS(0);                                //¹Ø±ÕÆ¬Ñ¡
 149   2          Delay_us(1);                         //ÑÓÊ±
 150   2          CS(1);                                //ÖØ¿ªÆ¬Ñ¡
 151   2          do                                   //Ã¦ÅÐ±ð
 152   2          {
 153   3            if(time>500) break;              //Èç¹ûÆÚ¼äÓÐÎÊÌâ£¬³¬Ê±ÍË³ö
 154   3            time++;
 155   3          }while(!DI());                         //Èç¹ûÆ÷¼þ×¼±¸¾ÍÐ÷£¬È¡ÏûÑ­»·
 156   2          CS(0);                                //¹Ø±ÕÆ¬Ñ¡
 157   2          Delay_us(1);
 158   2          if(AT93C46_Read_Byte(addr)==thedata) break; //ÅÐ¶ÏÐ´ÈëÊÇ·ñÕýÈ·£¬ÕýÈ·ÍË³öÑ­»·£¬·ñÔòÐ´ÈëÈý´Î
 159   2            i++;
 160   2        }while(i<3);                             //Ð´ÈëÈý´Î×Ô¶¯ÍË³ö
 161   1      }
 162          
 163          /**********************************************************
 164          *¹¦    ÄÜ£ºÔÚ93C46ÀïÃæµÄÖ¸¶¨µØÖ·¿ªÊ¼¶Á³öÖ¸¶¨¸öÊýµÄÊý¾Ý
 165          *²Î    Êý£ºReadAddr/¿ªÊ¼¶Á³öµÄµØÖ· ¶Ô24c01Îª0~127£»Buffer/Êý¾ÝÊý×éÊ×µØÖ·£»Buf_len/Òª¶Á³öÊý¾ÝµÄ¸öÊý
 166          *·µ »Ø Öµ£ºÎÞ
 167          **********************************************************/
 168          void AT93C46_Read(uint16_t ReadAddr,uint8_t *Buffer,uint16_t Buf_len)
 169          {
 170   1          while(Buf_len)
 171   1        {
 172   2          *Buffer++ =AT93C46_Read_Byte(ReadAddr++);
 173   2          Buf_len--;
 174   2        }
 175   1      }
 176          
 177          /**********************************************************
C51 COMPILER V9.54   93C46                                                                 10/16/2019 16:01:01 PAGE 4   

 178          *¹¦    ÄÜ£ºÔÚ93C46ÀïÃæµÄÖ¸¶¨µØÖ·¿ªÊ¼Ð´ÈëÖ¸¶¨¸öÊýµÄÊý¾Ý
 179          *²Î    Êý£ºWriteAddr/¿ªÊ¼Ð´ÈëµÄµØÖ· ¶Ô24c01Îª0~127£»Buffer/Êý¾ÝÊý×éÊ×µØÖ·£»Buf_len/ÒªÐ´ÈëÊý¾ÝµÄ¸öÊý
 180          *·µ »Ø Öµ£ºÎÞ
 181          ********************************************* *************/
 182          void AT93C46_Write(uint16_t WriteAddr,uint8_t *Buffer,uint16_t Buf_len)
 183          {
 184   1        while(Buf_len--)
 185   1        {
 186   2          AT93C46_Write_Byte(WriteAddr,*Buffer);
 187   2          WriteAddr++;
 188   2          Buffer++;
 189   2        }
 190   1      }
 191          /**********************************************************
 192          *¹¦    ÄÜ£º¼ì²é93C46ÊÇ·ñÕý³££¬ÕâÀïÓÃÁË24XXµÄ×îºóÒ»¸öµØÖ·(255)À´´æ´¢±êÖ¾×Ö£¬Èç¹ûÓÃÆäËû24CÏµÁÐ,Õâ¸öµØÖ·ÒªÐÞ¸
             -Ä
 193          *²Î    Êý£ºWriteAddr/¿ªÊ¼Ð´ÈëµÄµØÖ· ¶Ô24c01Îª0~127£»Buffer/Êý¾ÝÊý×éÊ×µØÖ·£»Buf_len/ÒªÐ´ÈëÊý¾ÝµÄ¸öÊý
 194          *·µ »Ø Öµ£º1/¼ì²âÊ§°Ü£»0/¼ì²â³É¹¦
 195          **********************************************************/
 196          uint8_t AT93C46_Check(void)
 197          {
 198   1        uint8_t temp = 0;
 199   1        temp =AT93C46_Read_Byte(255);
 200   1        if(temp == 0x55)
 201   1          return 0;
 202   1        else 
 203   1        {
 204   2          AT93C46_Write_Byte(255,0x55);
 205   2          temp =AT93C46_Read_Byte(255);
 206   2          if(temp == 0x55)
 207   2            return 0;
 208   2        }
 209   1        return 1;
 210   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    718    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----      24
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
