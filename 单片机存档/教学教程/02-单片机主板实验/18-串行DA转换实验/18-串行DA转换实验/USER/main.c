/***************************************************************************
实验名称：串行DA转换实验

实验模块：	STC8A核心板-V2.1、主板区：串行D/A转换

实验接线：	STC8A核心板   -----------   串行D/A转换
						  P2.0      -----------     CLK
							P2.1      -----------     DATA
							P2.2      -----------     LOAD
							P2.3      -----------     LDAC

现象描述：使用示波器观察J24口的DCDA输出周期性正弦波

更新时间：2022.06.07
***************************************************************************/
#include "intrins.h"
#include "system.h"
#include "dac.h"

unsigned char  code tab[128] =
{
    64, 67, 70, 73, 76, 79, 82, 85, 88, 91, 94, 96, 99, 102, 104, 106,
    109, 111, 113, 115, 117, 118, 120, 121, 123, 124, 125, 126, 126,
    127, 127, 127, 127, 127, 127, 127, 126, 126, 125, 124, 123, 121,
    120, 118, 117, 115, 113, 111, 109, 106, 104, 102, 99, 96, 94, 91,
    88, 85, 82, 79, 76, 73, 70, 67, 64, 60, 57, 54, 51, 48, 45, 42, 39,
    36, 33, 31, 28, 25, 23, 21, 18, 16, 14, 12, 10, 9, 7, 6, 4, 3, 2, 1,
    1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 2, 3, 4, 6, 7, 9, 10, 12, 14, 16, 18, 21, 23,
    25, 28, 31, 33, 36, 39, 42, 45, 48, 51, 54, 57, 60
};       //正弦数据表格

void main(void)
{
    uint16_t j;
    System_Init();			 //系统初始化
    DAC_Init();

    while(1)
    {

        LDAC = 0;
        LOAD = 1;
        Output_channel(0);    //选择通道A
        Write_RNG(1);         //设置输出电压范围在输入参考电压的两倍范围内

        if(++j == 128)
            j = 0;
        DAC_Start(tab[j]);
    }
}

//                                      endfile
